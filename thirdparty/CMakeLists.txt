if(MSVC)
        set (THIRDPARTY_RUNTIME_TYPE ${MSVC_RUNTIME_TYPE})
        if ("${THIRDPARTY_RUNTIME_TYPE}" STREQUAL "")
                string (FIND "${CURRENT_CXX_FLAGS}" "MT" THIRDPARTY_MT_POS REVERSE)
                string (FIND "${CURRENT_CXX_FLAGS}" "MD" THIRDPARTY_MD_POS REVERSE)
                if (NOT THIRDPARTY_MT_POS EQUAL -1)
                        set (THIRDPARTY_RUNTIME_TYPE "/MT")
                elseif (NOT THIRDPARTY_MD_POS EQUAL -1)
                        set (THIRDPARTY_RUNTIME_TYPE "/MD")
                else ()
                        message (STATUS "Dynamic C runtime assumed. Use 'MSVC_RUNTIME_TYPE' variable for override")
                        set (THIRDPARTY_RUNTIME_TYPE "/MD")
                endif()
        endif ()
endif ()

include (./thirdparty/thirdparty-${JINJA2CPP_DEPS_MODE}.cmake)

if(JINJA2CPP_BUILD_TESTS)
    find_package(gtest QUIET)

    if(gtest_FOUND)
        imported_target_alias(gtest ALIAS gtest::gtest)
    else()
        message(STATUS "gtest not found, using submodule")
        update_submodule(gtest)

        if(MSVC)
                        if (THIRDPARTY_RUNTIME_TYPE STREQUAL "/MD" OR THIRDPARTY_RUNTIME_TYPE STREQUAL "/MDd")
                                set (gtest_force_shared_crt ON CACHE BOOL "" FORCE)
                        else ()
                                set (gtest_force_shared_crt OFF CACHE BOOL "" FORCE)
                        endif ()
        endif ()

        add_subdirectory(thirdparty/gtest EXCLUDE_FROM_ALL)
    endif()
endif()
